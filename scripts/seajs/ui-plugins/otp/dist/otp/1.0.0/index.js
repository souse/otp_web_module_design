define("otp/1.0.0/index",["jquery","otp/1.0.0/OtpImageSuite","otp/1.0.0/otpAPI"],function(e,t,n){{var r=(e("jquery"),e("otp/1.0.0/OtpImageSuite"));e("otp/1.0.0/otpAPI")}n.exports=r}),define("otp/1.0.0/OtpImageSuite",[],function(e,t,n){!function(e){function t(e){return e&&"[object Function]"===f.call(e)}function r(e){var t=function(){};return t.prototype=e,new t}function a(e,t){var n=s[e];return n&&n.test(t)?!0:d[e]}function i(){c&&console&&"[object Console]"==f.call(console)&&console.log.apply(console,arguments)}function o(e,t){this.cfg=r(h);for(var n in t)t.hasOwnProperty(n)&&(this.cfg[n]=t[n]);if(!e)throw new Error("我们必须提供Otp ImageCode 的服务实例！");this.handlers={},this.receiver=null,this.service=e;var a,o=function(e,t){t=t||h.tickerSecond,c(),a=setTimeout(function(){i("ticker `%s` ",t),e.fireEvent("showTicker",t),t-=1,t>0?o(e,t):(t=0,e.fireEvent("closeTicker",t))},h.timeout)},c=function(){a&&(clearTimeout(a),a=0)};this._startTicker=function(e,t){o(e,t)}}var c=!0,s={phone:/^1[3-9][0-9]\d{8}$/,mobile:/^1[3-9][0-9]\d{8}$/,trim:/^\s+|\s+$/g},d={common:"系统内部错误",phone:"手机号码格式错误",mobile:"手机号码格式错误"},f=Object.prototype.toString,h={timeout:1e3,trySendOTPServiceName:"trySendOTP",ignoreMobileValidation:!1,tickerSecond:60};o.prototype={constructor:o,addHandler:function(e,n){"undefined"==typeof this.handlers[e]&&(this.handlers[e]=[]),t(n)&&this.handlers[e].push(n)},addReceiver:function(e){this.receiver=e},removeHandler:function(e,t){if(this.handlers[e]instanceof Array){for(var n=this.handlers[e],r=0,a=n.length;a>r&&n[r]!==t;r++);n.splice(r,1)}},fire:function(e){if(e.target||(e.target=this),this.receiver){if(!t(this.receiver))throw new Error("`receiver`接收器必须是一个函数！");this.receiver(e)}else if(this.handlers[e.type]instanceof Array)for(var n=this.handlers[e.type],r=0,a=n.length;a>r;r++)n[r](e)},fireEvent:function(e,t){i("fireEvent eventType: ",e," data:",t);var n={type:e,data:t||null};this.fire(n)},fireError:function(e,t){this.fireEvent("error",{code:e,message:t})},isMobile:function(e){return a("mobile",e)},trySendOTP:function(e,n,r,o){if(!this.cfg.ignoreMobileValidation){var c=a("phone",e);if(c!==!0)return void this.fireError("mobile_invalid",c)}this.fireEvent("OTPSending");var s=this,d=this.service[this.cfg.trySendOTPServiceName];return t(d)?void d.call(this.service,e,n,r,o,function(e){var t=e.data,n=e.code;switch(n){case"000000":s.fireEvent("OTPSentSuccess",t);var r=0;isNaN(t.retrySeconds)||(r=parseInt(t.retrySeconds)),s._startTicker(s,r);break;case"000001":var a=t.captcha;if(!a)throw Error("当前服务器端未传回Captha对象");s.fireEvent("captchaShow",a);break;default:i("nothing to do...., code: %s in `trySendOTP`",n),s.fireError(n,e.message)}}):void this.fireError("try_send_otp_service_undefined","自定义业务trySendOTP()不是一个函数")},refreshCaptcha:function(e){var t=this;this.service.refreshCaptcha(e,function(e){var n=e.code,r=e.data;switch(n){case"000000":t.fireEvent("captchaRefreshed",r.captcha);break;default:t.fireError("captcha_refreshed_failed",e.message)}})},verifyCaptcha:function(e,t){var n=this;this.service.verifyCaptcha(e,t,function(e){var t=e.code,r=e.data;switch(t){case"000000":n.fireEvent("tokenFlushed",r.captchaToken);break;default:n.fireError("token_flushed_failed",e.message)}})}},e.OtpImageSuite=o,"object"==typeof n&&n&&"object"==typeof n.exports?n.exports=o:"function"==typeof define&&define.amd&&define("OtpImageSuite",[],function(){return o})}(window)}),define("otp/1.0.0/otpAPI",[],function(){!function(e){var t="http://localhost:1100",n=function(e){var t={};return t.code=e.code,t.data=e.data,t.message=e.message,console.log("dataFilter: ",t),t},r=function(e){var t=n(e);return"000000"==t.code?t.data={maskedMobile:t.data.maskedMobile,retrySeconds:t.data.retrySeconds,otpId:t.data.otpId}:"000000"!=t.code&&"1184"==t.code&&(t.code="000001",t.data={captcha:{captchaId:t.data.captchaId,captchaUrl:t.data.captchaUrl}}),t},a=function(e){var t=n(e);return"000000"==t.code&&(t.data={captcha:{captchaId:t.data.captchaId,captchaUrl:t.data.captchaUrl}}),t},i=function(e){var t=n(e);return"000000"==t.code&&(t.data={captchaToken:t.data}),t};window.OtpAPI={trySendOTP:function(n,a,i,o,c){var s={phone:n};a&&(s.captchaToken=a),i&&(s.deviceId=i),e.extend(s,o),e.ajax({url:t+"/goutong/demo/sendSMSLogin",contentType:"application/json",type:"POST",dataType:"json",data:JSON.stringify(s),processData:!1}).then(function(e){c&&c(r(e))},function(){})},refreshCaptcha:function(n,r){var i={};e.extend(i,n),e.ajax({url:t+"/goutong/refreshCaptcha",contentType:"application/json",type:"POST",dataType:"json",data:JSON.stringify(i),processData:!1}).then(function(e){r&&r(a(e))},function(){})},verifyCaptcha:function(n,r,a){e.extend(n,r),e.ajax({url:t+"/goutong/verifyCaptcha",contentType:"application/json",type:"POST",dataType:"json",data:JSON.stringify(n),processData:!1}).then(function(e){a&&a(i(e))},function(){})}}}(jQuery)});