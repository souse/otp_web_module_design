define("otp/1.0.0/index",["jquery","otp/1.0.0/OtpImageSuite","otp/1.0.0/otpAPI"],function(e,t,a){var n=e("jquery"),r=e("otp/1.0.0/OtpImageSuite"),o=e("otp/1.0.0/otpAPI"),c={autoSendOtp:!1,leftSecondFormatter:"{0}s",dataCaptchaId:"captchaId",dataCaptchaToken:"captchaToken",mobileInputSelector:".mobile-input-selector",captchaControlSelector:"captcha-control-selector",captchaInputSelector:".captcha-input-selector",captchaImageSelector:".captcha-image-selector",otpGetSelector:".otp-get-btn-selector",otpInputSelector:".otp-input-selector",otpTickerSelector:".ticker-selector",eventListener:function(){},otpHasPassedCallback:function(){},otpErrorsCallback:function(){},getExtraData:function(){return null}},i=function(e,t,a){function o(){}function i(e){w.css("display","none"),T.otpHasPassedCallback&&T.otpHasPassedCallback({data:e})}function s(t){e.data(T.dataCaptchaToken,t||null)}function d(){return e.data(T.dataCaptchaToken)}function p(t){e.data(T.dataCaptchaId,t||null)}function f(){return e.data(T.dataCaptchaId)}function u(){return""}function h(e){var t=e.data,a=t.code,n=t.message,r=T.otpErrorsCallback||function(){};switch(a){case"mobile_invalid":r(a,n);break;case"captcha_refreshed_failed":r(a,n);break;case"token_flushed_failed":s(null),r(a,n);break;default:r(a,n)}}function l(e){I=!0,P.css("display","none"),j.css("display","block"),j.html(T.leftSecondFormatter.replace(new RegExp("\\{0\\}","g"),e))}function v(){I=!1,P.css("display","block"),j.css("display","none"),j.html("")}function y(e){var t=e;w.css("display","block"),b(t)}function S(){}function b(e){E.attr("src",e.captchaUrl?e.captchaUrl+"?r="+Math.random():""),p(e.captchaId)}function g(e){var t=e;s(t),T.autoSendOtp&&k()}function k(){var e=O.val(),t=d(),a=u()||"",r=n.extend({},T.getExtraData()||{});_.trySendOTP(e,t,a,r)}function m(){_.refreshCaptcha()}if(e=n(e),!e||!e.length)throw new Error("the context parameter required!");var T=n.extend({},c,a),I=!1,O=(T.eventListener,e.find(T.mobileInputSelector)),w=e.find(T.captchaControlSelector),C=e.find(T.captchaInputSelector),E=e.find(T.captchaImageSelector),P=e.find(T.otpGetSelector),j=(e.find(T.otpInputSelector),e.find(T.otpTickerSelector)),x={trySendOTPServiceName:T.trySendOtpServiceName,ignoreMobileValidation:T.ignoreMobileValidation},_=new r(t,x),A=function(){P.on("click",function(){k()}),C.on("change",function(){var e=n.trim(n(this).val());e&&e.length>=4&&_.verifyCaptcha({captchaInput:e,captchaId:f()})}),E.on("click",function(){I||m()})},M=function(){_.addReceiver(function(e){var t=e.type,a=e.data;switch(T.eventListener&&T.eventListener(e),t){case"OTPSending":o(e);break;case"OTPSentSuccess":i(a);break;case"error":h(e);break;case"showTicker":l(a);break;case"closeTicker":v(a);break;case"captchaShow":y(a);break;case"captchaRefreshed":b(a);break;case"tokenFlushed":g(a)}})};return function(){A(),M()}(),{start:function(){k()},reset:function(){S()},refreshCaptcha:m}};"object"==typeof a&&a&&"object"==typeof a.exports?a.exports={otpService:o,otpModule:i}:"function"==typeof define&&define.amd&&define("otp",[],function(){return{otpService:o,otpModule:i}})}),define("otp/1.0.0/OtpImageSuite",[],function(e,t,a){!function(e){function t(e){return e&&"[object Function]"===p.call(e)}function n(e){var t=function(){};return t.prototype=e,new t}function r(e,t){var a=s[e];return a&&a.test(t)?!0:d[e]}function o(){i&&console&&"[object Console]"==p.call(console)&&console.log.apply(console,arguments)}function c(e,t){this.cfg=n(f);for(var a in t)t.hasOwnProperty(a)&&t[a]&&(this.cfg[a]=t[a]);if(!e)throw new Error("我们必须提供Otp ImageCode 的服务实例！");this.handlers={},this.receiver=null,this.service=e;var r,c=function(e,t){t=t||f.tickerSecond,i(),r=setTimeout(function(){o("ticker `%s` ",t),e.fireEvent("showTicker",t),t-=1,t>0?c(e,t):(t=0,e.fireEvent("closeTicker",t))},f.timeout)},i=function(){r&&(clearTimeout(r),r=0)};this._startTicker=function(e,t){c(e,t)}}var i=!0,s={phone:/^1[3-9][0-9]\d{8}$/,mobile:/^1[3-9][0-9]\d{8}$/,trim:/^\s+|\s+$/g},d={common:"系统内部错误",phone:"手机号码格式错误",mobile:"手机号码格式错误"},p=Object.prototype.toString,f={timeout:1e3,trySendOTPServiceName:"trySendOTP",ignoreMobileValidation:!1,tickerSecond:60};c.prototype={constructor:c,addHandler:function(e,a){"undefined"==typeof this.handlers[e]&&(this.handlers[e]=[]),t(a)&&this.handlers[e].push(a)},addReceiver:function(e){this.receiver=e},removeHandler:function(e,t){if(this.handlers[e]instanceof Array){for(var a=this.handlers[e],n=0,r=a.length;r>n&&a[n]!==t;n++);a.splice(n,1)}},fire:function(e){if(e.target||(e.target=this),this.receiver){if(!t(this.receiver))throw new Error("`receiver`接收器必须是一个函数！");this.receiver(e)}else if(this.handlers[e.type]instanceof Array)for(var a=this.handlers[e.type],n=0,r=a.length;r>n;n++)a[n](e)},fireEvent:function(e,t){o("fireEvent eventType: ",e," data:",t);var a={type:e,data:t||null};this.fire(a)},fireError:function(e,t){this.fireEvent("error",{code:e,message:t})},isMobile:function(e){return r("mobile",e)},trySendOTP:function(e,a,n,c){if(!this.cfg.ignoreMobileValidation){var i=r("phone",e);if(i!==!0)return void this.fireError("mobile_invalid",i)}this.fireEvent("OTPSending");var s=this,d=this.service[this.cfg.trySendOTPServiceName];return t(d)?void d.call(this.service,e,a,n,c,function(e){var t=e.data,a=e.code;switch(a){case"000000":s.fireEvent("OTPSentSuccess",t);var n=0;isNaN(t.retrySeconds)||(n=parseInt(t.retrySeconds)),s._startTicker(s,n);break;case"000001":var r=t.captcha;if(!r)throw Error("当前服务器端未传回Captha对象");s.fireEvent("captchaShow",r);break;default:o("nothing to do...., code: %s in `trySendOTP`",a),s.fireError(a,e.message)}}):void this.fireError("try_send_otp_service_undefined","自定义业务trySendOTP()不是一个函数")},refreshCaptcha:function(e){var t=this;this.service.refreshCaptcha(e,function(e){var a=e.code,n=e.data;switch(a){case"000000":t.fireEvent("captchaRefreshed",n.captcha);break;default:t.fireError("captcha_refreshed_failed",e.message)}})},verifyCaptcha:function(e,t){var a=this;this.service.verifyCaptcha(e,t,function(e){var t=e.code,n=e.data;switch(t){case"000000":a.fireEvent("tokenFlushed",n.captchaToken);break;default:a.fireError("token_flushed_failed",e.message)}})}},e.OtpImageSuite=c,"object"==typeof a&&a&&"object"==typeof a.exports?a.exports=c:"function"==typeof define&&define.amd&&define("OtpImageSuite",[],function(){return c})}(window)}),define("otp/1.0.0/otpAPI",["jquery"],function(e,t,a){function n(e){return/^(ftp|http|https):\/\/[^ "]+$/.test(e)||(e=this.apiRoot+e),e}var r=e("jquery"),o=function(e){var t={};return t.code=e.code,t.data=e.data,t.message=e.message,t},c=function(e){var t=o(e);return"000000"==t.code?t.data={maskedMobile:t.data.maskedMobile,retrySeconds:t.data.retrySeconds,otpId:t.data.otpId}:"000000"!=t.code&&"1184"==t.code&&(t.code="000001",t.data={captcha:{captchaId:t.data.captchaId,captchaUrl:t.data.captchaUrl}}),t},i=function(e){var t=o(e);return"000000"==t.code&&(t.data={captcha:{captchaId:t.data.captchaId,captchaUrl:t.data.captchaUrl}}),t},s=function(e){var t=o(e);return"000000"==t.code&&(t.data={captchaToken:t.data}),t};window.OtpAPI={apiRoot:"http://localhost:1100",dtos:{baseAjaxDto:o,baseAjaxTrySendOTPDto:c,baseAjaxRefreshCaptchaDto:i,baseAjaxVerifyCaptchaDto:s},trySendOTP:function(e,t,a,o,i){var s={phone:e};t&&(s.captchaToken=t),a&&(s.deviceId=a),r.extend(s,o),r.ajax({url:n.call(this,"/selfcenter/changeSendOtp"),contentType:"application/json",type:"POST",dataType:"json",data:JSON.stringify(s),processData:!1}).then(function(e){i&&i(c(e))},function(e){throw new Error("status code:"+e.status)})},refreshCaptcha:function(e,t){var a={};r.extend(a,e),r.ajax({url:n.call(this,"/goutong/refreshCaptcha"),contentType:"application/json",type:"POST",dataType:"json",data:JSON.stringify(a),processData:!1}).then(function(e){t&&t(i(e))},function(e){throw new Error("status code:"+e.status)})},verifyCaptcha:function(e,t,a){r.extend(e,t),r.ajax({url:n.call(this,"/goutong/verifyCaptcha"),contentType:"application/json",type:"POST",dataType:"json",data:JSON.stringify(e),processData:!1}).then(function(e){a&&a(s(e))},function(e){throw new Error("status code:"+e.status)})}},"object"==typeof a&&a&&"object"==typeof a.exports?a.exports=window.OtpAPI:"function"==typeof define&&define.amd&&define("OtpAPI",[],function(){return window.OtpAPI})});