define("otp/1.0.0/index",["jquery","otp/1.0.0/OtpImageSuite","otp/1.0.0/otpAPI"],function(e,t,n){var r=e("jquery"),a=e("otp/1.0.0/OtpImageSuite"),o=e("otp/1.0.0/otpAPI"),i={autoSendOtp:!1,leftSecondFormatter:"{0}s",dataCaptchaId:"captchaId",dataCaptchaToken:"captchaToken",mobileInputSelector:".mobile-input-selector",captchaControlSelector:"captcha-control-selector",captchaInputSelector:".captcha-input-selector",captchaImageSelector:".captcha-image-selector",otpGetSelector:".otp-get-btn-selector",otpInputSelector:".otp-input-selector",otpTickerSelector:".ticker-selector",eventListener:function(){},otpHasPassedCallback:function(){},otpErrorsCallback:function(){},getExtraData:function(){return null}},c=function(e,t,n){function o(){return e.data(f.dataCaptchaToken)}function c(){return""}function s(){}function p(){var e=h.val(),t=o(),n=c()||"",a=r.extend({},f.getExtraData()||{});l.trySendOTP(e,t,n,a)}function d(){l.refreshCaptcha()}if(e=r(e),!e||!e.length)throw new Error("the context parameter required!");var f=r.extend({},i,n),h=(f.eventListener,e.find(f.mobileInputSelector)),u=(e.find(captchaControlSelector),e.find(f.captchaInputSelector),e.find(f.captchaImageSelector),e.find(f.otpGetSelector),e.find(f.otpInputSelector),e.find(f.otpTickerSelector),{trySendOTPServiceName:f.trySendOtpServiceName,ignoreMobileValidation:f.ignoreMobileValidation}),l=new a(t,u);return{start:function(){p()},reset:function(){s()},refreshCaptcha:d}};"object"==typeof n&&n&&"object"==typeof n.exports?n.exports={OtpService:o,otp:c}:"function"==typeof define&&define.amd&&define("otp",[],function(){return{OtpService:o,otp:c}})}),define("otp/1.0.0/OtpImageSuite",[],function(e,t,n){!function(e){function t(e){return e&&"[object Function]"===d.call(e)}function r(e){var t=function(){};return t.prototype=e,new t}function a(e,t){var n=s[e];return n&&n.test(t)?!0:p[e]}function o(){c&&console&&"[object Console]"==d.call(console)&&console.log.apply(console,arguments)}function i(e,t){this.cfg=r(f);for(var n in t)t.hasOwnProperty(n)&&(this.cfg[n]=t[n]);if(!e)throw new Error("我们必须提供Otp ImageCode 的服务实例！");this.handlers={},this.receiver=null,this.service=e;var a,i=function(e,t){t=t||f.tickerSecond,c(),a=setTimeout(function(){o("ticker `%s` ",t),e.fireEvent("showTicker",t),t-=1,t>0?i(e,t):(t=0,e.fireEvent("closeTicker",t))},f.timeout)},c=function(){a&&(clearTimeout(a),a=0)};this._startTicker=function(e,t){i(e,t)}}var c=!0,s={phone:/^1[3-9][0-9]\d{8}$/,mobile:/^1[3-9][0-9]\d{8}$/,trim:/^\s+|\s+$/g},p={common:"系统内部错误",phone:"手机号码格式错误",mobile:"手机号码格式错误"},d=Object.prototype.toString,f={timeout:1e3,trySendOTPServiceName:"trySendOTP",ignoreMobileValidation:!1,tickerSecond:60};i.prototype={constructor:i,addHandler:function(e,n){"undefined"==typeof this.handlers[e]&&(this.handlers[e]=[]),t(n)&&this.handlers[e].push(n)},addReceiver:function(e){this.receiver=e},removeHandler:function(e,t){if(this.handlers[e]instanceof Array){for(var n=this.handlers[e],r=0,a=n.length;a>r&&n[r]!==t;r++);n.splice(r,1)}},fire:function(e){if(e.target||(e.target=this),this.receiver){if(!t(this.receiver))throw new Error("`receiver`接收器必须是一个函数！");this.receiver(e)}else if(this.handlers[e.type]instanceof Array)for(var n=this.handlers[e.type],r=0,a=n.length;a>r;r++)n[r](e)},fireEvent:function(e,t){o("fireEvent eventType: ",e," data:",t);var n={type:e,data:t||null};this.fire(n)},fireError:function(e,t){this.fireEvent("error",{code:e,message:t})},isMobile:function(e){return a("mobile",e)},trySendOTP:function(e,n,r,i){if(!this.cfg.ignoreMobileValidation){var c=a("phone",e);if(c!==!0)return void this.fireError("mobile_invalid",c)}this.fireEvent("OTPSending");var s=this,p=this.service[this.cfg.trySendOTPServiceName];return t(p)?void p.call(this.service,e,n,r,i,function(e){var t=e.data,n=e.code;switch(n){case"000000":s.fireEvent("OTPSentSuccess",t);var r=0;isNaN(t.retrySeconds)||(r=parseInt(t.retrySeconds)),s._startTicker(s,r);break;case"000001":var a=t.captcha;if(!a)throw Error("当前服务器端未传回Captha对象");s.fireEvent("captchaShow",a);break;default:o("nothing to do...., code: %s in `trySendOTP`",n),s.fireError(n,e.message)}}):void this.fireError("try_send_otp_service_undefined","自定义业务trySendOTP()不是一个函数")},refreshCaptcha:function(e){var t=this;this.service.refreshCaptcha(e,function(e){var n=e.code,r=e.data;switch(n){case"000000":t.fireEvent("captchaRefreshed",r.captcha);break;default:t.fireError("captcha_refreshed_failed",e.message)}})},verifyCaptcha:function(e,t){var n=this;this.service.verifyCaptcha(e,t,function(e){var t=e.code,r=e.data;switch(t){case"000000":n.fireEvent("tokenFlushed",r.captchaToken);break;default:n.fireError("token_flushed_failed",e.message)}})}},e.OtpImageSuite=i,"object"==typeof n&&n&&"object"==typeof n.exports?n.exports=i:"function"==typeof define&&define.amd&&define("OtpImageSuite",[],function(){return i})}(window)}),define("otp/1.0.0/otpAPI",["jquery"],function(e,t,n){function r(e){return/^(ftp|http|https):\/\/[^ "]+$/.test(e)||(e=apiBaseUrl+e),e}var a=e("jquery"),o=function(e){var t={};return t.code=e.code,t.data=e.data,t.message=e.message,t},i=function(e){var t=o(e);return"000000"==t.code?t.data={maskedMobile:t.data.maskedMobile,retrySeconds:t.data.retrySeconds,otpId:t.data.otpId}:"000000"!=t.code&&"1184"==t.code&&(t.code="000001",t.data={captcha:{captchaId:t.data.captchaId,captchaUrl:t.data.captchaUrl}}),t},c=function(e){var t=o(e);return"000000"==t.code&&(t.data={captcha:{captchaId:t.data.captchaId,captchaUrl:t.data.captchaUrl}}),t},s=function(e){var t=o(e);return"000000"==t.code&&(t.data={captchaToken:t.data}),t};window.OtpAPI={apiRoot:"http://localhost:1100",dtos:{baseAjaxDto:o,baseAjaxTrySendOTPDto:i,baseAjaxRefreshCaptchaDto:c,baseAjaxVerifyCaptchaDto:s},trySendOTP:function(e,t,n,o,c){var s={phone:e};t&&(s.captchaToken=t),n&&(s.deviceId=n),a.extend(s,o),a.ajax({url:r("/goutong/demo/sendSMSLogin"),contentType:"application/json",type:"POST",dataType:"json",data:JSON.stringify(s),processData:!1}).then(function(e){c&&c(i(e))},function(){})},refreshCaptcha:function(e,t){var n={};a.extend(n,e),a.ajax({url:r("/goutong/refreshCaptcha"),contentType:"application/json",type:"POST",dataType:"json",data:JSON.stringify(n),processData:!1}).then(function(e){t&&t(c(e))},function(){})},verifyCaptcha:function(e,t,n){a.extend(e,t),a.ajax({url:r("/goutong/verifyCaptcha"),contentType:"application/json",type:"POST",dataType:"json",data:JSON.stringify(e),processData:!1}).then(function(e){n&&n(s(e))},function(){})}},"object"==typeof n&&n&&"object"==typeof n.exports?n.exports=window.OtpAPI:"function"==typeof define&&define.amd&&define("OtpAPI",[],function(){return window.OtpAPI})});